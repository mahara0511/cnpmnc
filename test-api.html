<!DOCTYPE html>
<html>
  <head>
    <title>API Test - Production Server</title>
    <meta charset="UTF-8" />
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        border-bottom: 3px solid #007bff;
        padding-bottom: 10px;
      }
      .section {
        margin: 20px 0;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 5px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }
      input,
      select {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
      }
      button {
        padding: 12px 24px;
        background: #007bff;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        font-size: 14px;
        margin: 5px;
        transition: background 0.3s;
      }
      button:hover {
        background: #0056b3;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      pre {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 20px;
        border-radius: 5px;
        overflow-x: auto;
        font-size: 13px;
        line-height: 1.5;
      }
      .error {
        color: #dc3545;
        font-weight: bold;
      }
      .success {
        color: #28a745;
        font-weight: bold;
      }
      .info {
        background: #e7f3ff;
        padding: 10px;
        border-left: 4px solid #007bff;
        margin: 10px 0;
      }
      hr {
        border: none;
        border-top: 2px solid #eee;
        margin: 30px 0;
      }
      .btn-group {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ü§ñ AI Chat Test - Production Server</h1>

      <div class="info">
        <strong>Server:</strong> http://be.cnpmnc.khanhzip14.io.vn<br />
        <strong>Swagger UI:</strong>
        <a
          href="http://be.cnpmnc.khanhzip14.io.vn/swagger-ui/index.html"
          target="_blank"
          >Open Swagger</a
        >
      </div>

      <div class="section">
        <h3>1Ô∏è‚É£ Select Account & Login</h3>
        <label>Quick Select Account:</label>
        <select id="accountSelect" onchange="selectAccount()">
          <option value="">-- Select an account --</option>
          <option value="supervisor1">
            Supervisor 1 (supervisor1@gmail.com)
          </option>
          <option value="supervisor2">
            Supervisor 2 (supervisor2@gmail.com)
          </option>
          <option value="employee1">
            Employee - John Smith (john@gmail.com)
          </option>
          <option value="employee2">
            Employee - Sarah Brown (sarah@gmail.com)
          </option>
          <option value="employee3">
            Employee - Mike Taylor (mike@gmail.com)
          </option>
        </select>

        <label>Email:</label>
        <input
          type="email"
          id="email"
          placeholder="Enter email"
          value="supervisor1@gmail.com"
        />

        <label>Password:</label>
        <input
          type="password"
          id="password"
          placeholder="Enter password"
          value="password123"
        />

        <button onclick="login()">üîê Login</button>
      </div>

      <hr />

      <div class="section">
        <h3>2Ô∏è‚É£ Token (Auto-filled after login)</h3>
        <input
          type="text"
          id="token"
          placeholder="Token will appear here after login"
          readonly
        />
        <small style="color: #666"
          >Token is automatically copied after successful login</small
        >
      </div>

      <hr />

      <div class="section">
        <h3>3Ô∏è‚É£ Send Message to AI</h3>
        <label>Your Message:</label>
        <input
          type="text"
          id="message"
          placeholder="Type your question..."
          value="How am I doing?"
        />

        <label>Quick Questions:</label>
        <div class="btn-group">
          <button onclick="setMessage('How am I doing?')">
            General Performance
          </button>
          <button onclick="setMessage('What are my strengths?')">
            My Strengths
          </button>
          <button onclick="setMessage('How can I improve?')">
            Improvement Areas
          </button>
          <button onclick="setMessage('Tell me about assessment #1')">
            Assessment #1
          </button>
          <button onclick="setMessage('What is problem solving?')">
            Criteria Info
          </button>
        </div>

        <div class="btn-group" style="margin-top: 15px">
          <button onclick="testChat()">üí¨ Send to Supervisor AI</button>
          <button onclick="testEmployeeChat()">üë§ Send to Employee AI</button>
          <button onclick="testSuggestComment()">
            üí° Get Comment Suggestion
          </button>
        </div>
      </div>

      <hr />

      <div class="section">
        <h3>4Ô∏è‚É£ AI Response</h3>
        <pre id="result">‚è≥ Waiting for request...</pre>
      </div>
    </div>

    <script>
      // Production server URL
      const API_URL = 'http://be.cnpmnc.khanhzip14.io.vn';

      // Account presets
      const accounts = {
        supervisor1: {
          email: 'supervisor1@gmail.com',
          password: 'password123',
        },
        supervisor2: {
          email: 'supervisor2@gmail.com',
          password: 'password123',
        },
        employee1: { email: 'john@gmail.com', password: 'password123' },
        employee2: { email: 'sarah@gmail.com', password: 'password123' },
        employee3: { email: 'mike@gmail.com', password: 'password123' },
      };

      function selectAccount() {
        const select = document.getElementById('accountSelect');
        const account = accounts[select.value];
        if (account) {
          document.getElementById('email').value = account.email;
          document.getElementById('password').value = account.password;
        }
      }

      function setMessage(msg) {
        document.getElementById('message').value = msg;
      }

      async function login() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        if (!email || !password) {
          alert('Please enter email and password!');
          return;
        }

        try {
          document.getElementById('result').textContent = 'üîÑ Logging in...';

          const response = await fetch(`${API_URL}/auth/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password }),
          });

          const data = await response.json();

          if (response.ok && data.data && data.data.accessToken) {
            const token = data.data.accessToken;
            document.getElementById('token').value = token;

            // Show user info
            const user = data.data.user || {};
            document.getElementById('result').innerHTML =
              '<span class="success">‚úÖ Login Successful!</span>\n\n' +
              `User: ${user.name || email}\n` +
              `Role: ${user.role || 'N/A'}\n` +
              `Email: ${email}\n\n` +
              'Token: ' +
              token.substring(0, 50) +
              '...\n\n' +
              'Full Response:\n' +
              JSON.stringify(data, null, 2);
          } else {
            document.getElementById('result').innerHTML =
              '<span class="error">‚ùå Login Failed!</span>\n\n' +
              JSON.stringify(data, null, 2);
          }
        } catch (error) {
          document.getElementById('result').innerHTML =
            '<span class="error">‚ùå Network Error:</span>\n\n' +
            error.message +
            '\n\n' +
            'Please check:\n' +
            '1. Server is running\n' +
            '2. CORS is configured\n' +
            '3. Network connection';
        }
      }

      async function testChat() {
        const token = document.getElementById('token').value;
        const message = document.getElementById('message').value;

        if (!token) {
          alert('Please login first to get token!');
          return;
        }

        if (!message) {
          alert('Please enter a message!');
          return;
        }

        try {
          document.getElementById('result').textContent =
            'ü§ñ Sending to Supervisor AI...';

          const response = await fetch(`${API_URL}/ai/chat`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ message }),
          });

          const data = await response.json();

          if (response.ok) {
            document.getElementById('result').innerHTML =
              '<span class="success">‚úÖ AI Response (Supervisor Chat):</span>\n\n' +
              JSON.stringify(data, null, 2);
          } else {
            document.getElementById('result').innerHTML =
              '<span class="error">‚ùå Error:</span>\n\n' +
              `Status: ${response.status} ${response.statusText}\n\n` +
              JSON.stringify(data, null, 2);
          }
        } catch (error) {
          document.getElementById('result').innerHTML =
            '<span class="error">‚ùå Fetch Error:</span>\n\n' + error.message;
        }
      }

      async function testEmployeeChat() {
        const token = document.getElementById('token').value;
        const message = document.getElementById('message').value;

        if (!token) {
          alert('Please login first to get token!');
          return;
        }

        if (!message) {
          alert('Please enter a message!');
          return;
        }

        try {
          document.getElementById('result').textContent =
            'üë§ Sending to Employee AI...';

          const response = await fetch(`${API_URL}/ai/employee/chat`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify({ message }),
          });

          const data = await response.json();

          if (response.ok) {
            document.getElementById('result').innerHTML =
              '<span class="success">‚úÖ AI Response (Employee Chat):</span>\n\n' +
              JSON.stringify(data, null, 2);
          } else {
            document.getElementById('result').innerHTML =
              '<span class="error">‚ùå Error:</span>\n\n' +
              `Status: ${response.status} ${response.statusText}\n\n` +
              JSON.stringify(data, null, 2);
          }
        } catch (error) {
          document.getElementById('result').innerHTML =
            '<span class="error">‚ùå Fetch Error:</span>\n\n' + error.message;
        }
      }

      async function testSuggestComment() {
        const token = document.getElementById('token').value;

        if (!token) {
          alert('Please login first to get token!');
          return;
        }

        try {
          document.getElementById('result').textContent =
            'üí° Getting AI comment suggestion...';

          // Example request for comment suggestion
          const requestBody = {
            criteriaId: 1,
            score: 85,
            employeeName: 'John Smith',
          };

          const response = await fetch(`${API_URL}/ai/suggest-comment`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${token}`,
            },
            body: JSON.stringify(requestBody),
          });

          const data = await response.json();

          if (response.ok) {
            document.getElementById('result').innerHTML =
              '<span class="success">‚úÖ AI Comment Suggestion:</span>\n\n' +
              JSON.stringify(data, null, 2);
          } else {
            document.getElementById('result').innerHTML =
              '<span class="error">‚ùå Error:</span>\n\n' +
              `Status: ${response.status} ${response.statusText}\n\n` +
              JSON.stringify(data, null, 2);
          }
        } catch (error) {
          document.getElementById('result').innerHTML =
            '<span class="error">‚ùå Fetch Error:</span>\n\n' + error.message;
        }
      }

      // Auto-focus email field on load
      window.onload = function () {
        document.getElementById('email').focus();
      };
    </script>
  </body>
</html>
